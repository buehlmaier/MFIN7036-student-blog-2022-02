<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="https://buehlmaier.github.io/MFIN7036-student-blog-2022-02/theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://buehlmaier.github.io/MFIN7036-student-blog-2022-02/theme/css/custom.css" media="screen">

        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="author" content="MFIN7036 Students" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content=", Progress Report, " />

<meta property="og:title" content="Using Selenium to Scrape Customer Reviews (Group DeepDiver) "/>
<meta property="og:url" content="https://buehlmaier.github.io/MFIN7036-student-blog-2022-02/using-selenium-to-scrape-customer-reviews-group-deepdiver.html" />
<meta property="og:description" content="By Group &#34;DeepDiver&#34; The DeepDiver group tried to analyze customer reviews from different shopping websites, like Amazon, BestBuy, Target. We encountered some problems in the web-scrapting process, and after trial and error, we succeeded in gathering the data we needed. This blog is about the bugs/problems we met and …" />
<meta property="og:site_name" content="MFIN7036 Student Blog" />
<meta property="og:article:author" content="MFIN7036 Students" />
<meta property="og:article:published_time" content="2022-03-16T20:29:00+08:00" />
<meta name="twitter:title" content="Using Selenium to Scrape Customer Reviews (Group DeepDiver) ">
<meta name="twitter:description" content="By Group &#34;DeepDiver&#34; The DeepDiver group tried to analyze customer reviews from different shopping websites, like Amazon, BestBuy, Target. We encountered some problems in the web-scrapting process, and after trial and error, we succeeded in gathering the data we needed. This blog is about the bugs/problems we met and …">

        <title>Using Selenium to Scrape Customer Reviews (Group DeepDiver)  · MFIN7036 Student Blog
</title>
        <link href="https://buehlmaier.github.io/MFIN7036-student-blog-2022-02/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="MFIN7036 Student Blog - Full Atom Feed" />



    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://buehlmaier.github.io/MFIN7036-student-blog-2022-02/"><span class=site-name>MFIN7036 Student Blog</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://buehlmaier.github.io/MFIN7036-student-blog-2022-02
                                    >Home</a>
                                </li>
                                <li ><a href="https://buehlmaier.github.io/MFIN7036-student-blog-2022-02/categories.html">Categories</a></li>
                                <li ><a href="https://buehlmaier.github.io/MFIN7036-student-blog-2022-02/tags.html">Tags</a></li>
                                <li ><a href="https://buehlmaier.github.io/MFIN7036-student-blog-2022-02/archives.html">Archives</a></li>
                                <li><form class="navbar-search" action="https://buehlmaier.github.io/MFIN7036-student-blog-2022-02/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://buehlmaier.github.io/MFIN7036-student-blog-2022-02/using-selenium-to-scrape-customer-reviews-group-deepdiver.html">
                Using Selenium to Scrape Customer Reviews (Group DeepDiver)
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <p>By Group "DeepDiver"</p>
<p>The DeepDiver group tried to analyze customer reviews from different
shopping websites, like <a href="https://www.amazon.com/">Amazon</a>,
<a href="https://www.bestbuy.com/?intl=nosplash">BestBuy</a>,
<a href="https://www.target.com/">Target</a>. We encountered some problems in the
web-scrapting process, and after trial and error, we succeeded in
gathering the data we needed. This blog is about the bugs/problems we
met and how we found solutions, mainly about locating elements and
dealing with dynamic contents.</p>
<p>The whole process was like this: first we initiated Google Chrome via
<code>ChromeDriver</code>, loaded the comment page, located the comment title,
content and other information we need, then clicked the next page
button, each time the button was clicked, 8 or 10 more comments were
automatically loaded. We then concated together the comments for each
page and exported to a <code>.csv</code> file for use next time.</p>
<h3>Problem 1: The review list was not loaded until the page has scrolled to the bottom</h3>
<p><strong>Solution</strong>: Every time a new page was opened, the browser
automatically scrolled to review list area in the bottom of the page,
which was about 1500px above from the footer of the page. Then the
function slept for a while and waited for the review contents to be
loaded. Otherwise, we still can not get the comment content.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Scroll down to bottom</span>
<span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s1">&#39;window.scrollTo(0, document.body.scrollHeight-1500);&#39;</span><span class="p">)</span>
<span class="c1"># Wait to load page</span>
<span class="n">RANDOM_SLEEP_TIME</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">RANDOM_SLEEP_TIME</span><span class="p">)</span>
</code></pre></div>

<h3>Problem 2: Some reviews only had review title, without content</h3>
<p>We saved the review titles and contents into two lists, and found that
the lengths of the two lists were different. The review title list
contained more items than review content list, since some comments
only had titles and no content.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Gather info on each page</span>
<span class="n">review_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="p">[]}</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="c1"># get the reviews&#39; title and content</span>
    <span class="n">review_title</span> <span class="o">=</span> <span class="p">[</span><span class="n">title</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">title</span> <span class="ow">in</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;[data-hook=&quot;review-title&quot;]&#39;</span><span class="p">)]</span>
    <span class="n">review_content</span> <span class="o">=</span> <span class="p">[</span><span class="n">content</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;[data-hook=&quot;review-body&quot;]&#39;</span><span class="p">)]</span>
    <span class="c1"># join the original list with &#39;+&#39;</span>
    <span class="n">review_dict</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">review_dict</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">review_title</span>
    <span class="n">review_dict</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">review_dict</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">review_content</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="go">len(review_dict[&#39;title&#39;])</span>
<span class="go">Out[32]: 1306</span>
<span class="go">len(review_dict[&#39;content&#39;])</span>
<span class="go">Out[33]: 1084</span>
</code></pre></div>

<p><strong>Solution:</strong> Change the data structure, save a single comment into a
dictionary, then insert all the dictionaries of that page into an
array.</p>
<div class="highlight"><pre><span></span><code><span class="n">reviews_current_page</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">review</span> <span class="ow">in</span> <span class="n">review_list</span><span class="p">:</span>
    <span class="n">current_review</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># single review</span>
    <span class="n">current_review</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">review</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;[data-test=&quot;review-card--username&quot;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="n">current_review</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">review</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;[data-test=&quot;review-card--title&quot;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="n">current_review</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">review</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;[data-test=&quot;review-card--text&quot;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="n">current_review</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">review</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;[data-test=&quot;review-card--reviewTime&quot;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="n">current_review</span><span class="p">[</span><span class="s1">&#39;stars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">review</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s1">&#39;ilnowk&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="n">reviews_current_page</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_review</span><span class="p">)</span> <span class="c1"># Append reviews to review list</span>
</code></pre></div>

<h3>Problem 3: The Class Name of the element contained a dynamic hash, and cannot be obtained by <code>CLASS_NAME</code></h3>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">h3</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Heading__StyledHeading-sc-1mp23s9-0 jCmZWX&quot;</span> <span class="na">data-test</span><span class="o">=</span><span class="s">&quot;review-card--title&quot;</span> <span class="na">tabindex</span><span class="o">=</span><span class="s">&quot;-1&quot;</span><span class="p">&gt;</span>Love this toothbrush<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
</code></pre></div>

<p><strong>Solution:</strong> The <code>data-</code> attribute of the element was fixed, we could
use <code>CSS_SELECTOR</code> instead of <code>CLASS_NAME</code> to get the element.</p>
<div class="highlight"><pre><span></span><code><span class="n">current_review</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">review</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;[data-test=&quot;review-card--title&quot;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</code></pre></div>

<h3>Problem 4: When jumping to the next page, the 'Load 8 more' button was not found</h3>
<div class="highlight"><pre><span></span><code>StaleElementReferenceException: stale element reference: element is not attached to the page document
</code></pre></div>

<p><strong>Solution:</strong> There were two possibilities: one was that the element
had not been loaded, and the other was that the element might have
been removed. We replaced <code>presence_of_element_located</code> with
<code>element_to_be_clickable</code>, still invalid</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>

<span class="n">next_page_path</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">RANDOM_SLEEP_TIME</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="s1">&#39;//*[@id=&quot;pageBodyContainer&quot;]/div[11]/div[8]/button&#39;</span><span class="p">)))</span>
</code></pre></div>

<p>Then we found that the button's XPath changed after turning the page,
from <code>//*[@id="pageBodyContainer"]/div[11]/div[8]/button</code> to
<code>//*[@id="pageBodyContainer"]/div[10]/div[8]/button</code> . So XPath cannot
be used, but <code>&lt;button&gt;</code> itself did not have an obvious <code>class name</code>,
only its parent element has the <code>data-test="load-more-btn"</code> attribute,
so the <code>CSS SELECTOR</code> was used, first located the parent element, and
then used <code>&gt;</code> to get child element button.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="n">next_page_path</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span> <span class="n">RANDOM_SLEEP_TIME</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;[data-test=&quot;load-more-btn&quot;]&gt;button&#39;</span><span class="p">)))</span> 
</code></pre></div>

<h3>Problem 5: Empty elements when crawling</h3>
<div class="highlight"><pre><span></span><code>NoSuchElementException: Message: no such element: Unable to locate element: <span class="o">{</span><span class="s2">&quot;method&quot;</span>:<span class="s2">&quot;css selector&quot;</span>,<span class="s2">&quot;selector&quot;</span>:<span class="s2">&quot;[data-hook=&quot;</span>helpful-vote-statement<span class="s2">&quot;]&quot;</span><span class="o">}</span>
</code></pre></div>

<p><strong>Solution:</strong> If the comment was "0 guest found this helpful", then
this text would not be displayed, so the program reported an
<code>NoSuchElementException error</code>. We needed to add a <code>try except</code> to
deal with the empty element. If this element was not found, fill this
item manually.</p>
<div class="highlight"><pre><span></span><code><span class="k">try</span><span class="p">:</span>
    <span class="n">current_review</span><span class="p">[</span><span class="s1">&#39;vote&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">review</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s1">&#39;[data-hook=&quot;helpful-vote-statement&quot;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
<span class="k">except</span> <span class="n">NoSuchElementException</span><span class="p">:</span>
    <span class="n">current_review</span><span class="p">[</span><span class="s1">&#39;vote&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;0 people found this helpful&#39;</span>
</code></pre></div>


             
 
            
            
            







            <hr/>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2022-03-16T20:29:00+08:00">Wed 16 March 2022</time>
            <h4>Category</h4>
            <a class="category-link" href="https://buehlmaier.github.io/MFIN7036-student-blog-2022-02/categories.html#progress-report-ref">Progress Report</a>
<h4>Contact</h4>
<div id="sidebar-social-link">
    <a href="https://github.com/buehlmaier/MFIN7036-student-blog-2022-02" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="https://buehlmaier.github.io/MFIN7036-student-blog-2022-02/theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>